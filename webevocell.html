<!DOCTYPE html>
<html lang="en-us">
<head>
	<link type="text/css" rel="stylesheet" href="style.css" />
	<script src="src/libs/DataView.js"></script>

	<script src="src/libs/jquery-1.6.2.min.js"></script>
	<script type="text/javascript">
	  $.noConflict();
	  // Code that uses other library's $ can follow here.
	</script>
	
	<script src="src/libs/scriptaculous-js-1.9.0/prototype.js" type="text/javascript"></script>
	<script src="src/libs/scriptaculous-js-1.9.0/scriptaculous.js" type="text/javascript"></script>
	
	<script src="src/libs/FileSaver.js" type="text/javascript" ></script>

	<script src="src/helpers.js"></script>
	<script src="src/evocellweb.js"></script>

	<script src="src/mutationlabgui.js"></script>

	<script id="shader-vs-passthrough" type="x-shader/x-vertex"> 
		attribute vec3 aPos;
		attribute vec2 aTexCoord;
		varying   vec2 vTexCoord;

		void main(void) {
			gl_Position = vec4(aPos, 1.);
			vTexCoord = aTexCoord;
		}
	</script> 

	<script id="shader-fs-palette" type="x-shader/x-fragment"> 
		#ifdef GL_ES
		precision highp float;
		#endif
		uniform sampler2D texFrame;
		varying vec2 vTexCoord;
		void main(void) {
			vec4 color = texture2D(texFrame, vTexCoord);
			//if (color.a == 0.)
			//	gl_FragColor = vec4(0., 0., 0., 0.);
			//else
				gl_FragColor = vec4(color.a*600.0, color.a*color.a*color.a*400000.0, 0., 1.);
   
			//gl_FragColor = texture2D(texFrame, vTexCoord);
		}
	</script>
	
		<script id="shader-fs-paletteAndScale" type="x-shader/x-fragment"> 
		#ifdef GL_ES
		precision highp float;
		#endif

		#define XSIZE 499.0
		#define YSIZE 399.0
		#define SCALE 5.0
		#define BORDER 2.0

		#define XPIXELSIZE (1.0/XSIZE)
		#define YPIXELSIZE (1.0/YSIZE)

		uniform sampler2D texFrame;
		varying vec2 vTexCoord;
		void main(void) {
			vec2 vCT;
			vCT.x = vTexCoord.x/5.;
			vCT.y = vTexCoord.y/5.;

			float xFMod = mod(vTexCoord.x, SCALE*XPIXELSIZE);
			float yFMod = mod(vTexCoord.y, SCALE*YPIXELSIZE);

			//int xmod = int(vTexCoord.x * 499.0);
			//int xmm = xmod / 5;
			//xmod = xmod - (xmm * 5);
			//xmod = xmod % 5;

			//int ymod = int(vTexCoord.y * 399.0);
			//int ymm = ymod / 5;
			//ymod = ymod - (ymm * 5);

			//if (xmod == 0 || ymod == 0)
			if (xFMod <= XPIXELSIZE*BORDER || yFMod <= YPIXELSIZE*BORDER)
			{
				gl_FragColor = vec4(0.,0.,0.,1.);
			}
			else
			{
				vec4 color = texture2D(texFrame, vCT);
				//if (color.a == 0.)
				//	gl_FragColor = vec4(0., 0., 0., 0.);
				//else
					gl_FragColor = vec4(color.a*600.0, color.a*color.a*color.a*400000.0, 0., 1.);
		
				//gl_FragColor = texture2D(texFrame, vTexCoord);
			}
		}
	</script>

</head>
<body onload="setup()">

	<div id="floatingPalette" style="position:fixed; width:240px; height:150px; background-color:#fdd; cursor:move; z-index:100;">
	<div id="floatingPaletteHeader"><input type='checkbox' id='paletteStealth' />hide palette</div>
	<div id="floatingPaletteOptions" style="position:relative;"></div>
 	<div id="floatingPaletteNeighbours" style="position:relative;"></div>
	
	</div>


	<canvas id="c" width="10" height="10" style="border:1px solid gray;" ></canvas>

	<form name="controls" action="">
	<input type="button" id="cmdRunPause" value="run/pause" onclick="pausePlease = !pausePlease; if (!pausePlease) anim();">
	<input type="button" id="cmdSingleStep" value="one step" onclick="oneStep(); updateFrame();">
	<input type="number" id="randomDensity" min="0" max="1" step="0.001" value="0.01"">
	<input type="button" value="Randomize" onclick="handleRandomize();">

	<input type="number" id="xres" name="xres" min="100" max="4000" value="1000" onchange="handleReset();" />
	<input type="number" id="yres" name="yres" min="100" max="4000" value="3333" onchange="handleReset();" />
	
	<input type="number" id="nrSims" min="1" max="6" step="1" value="2" onchange="handleReset();">
	<input type="button" value="Reset" onclick="handleReset(1);">
	<input type="file" value="evocellFile" id="evocellFile" />
	fps<input size="1" id="framerate">
	<a id="downloadRuleFile">hier kommt dann die regel</a>
	</form>

	<div id="canvasContainer" style="border:1px solid green; position:absolute;"></div>
</body>
</html>
